<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Reservation / Anfrage - Bed & Breakfast Tulipan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Kontakt und Reservierungsanfrage für das Bed & Breakfast Tulipan in Einsiedeln." />
  <link rel="stylesheet" href="/bnb_website/css/styles.css" />
</head>
<body>
  <div id="header"></div>
  <script>
    fetch('/bnb_website/header.html')
      .then(r=>r.text())
      .then(html => {
        const h = document.getElementById('header');
        h.innerHTML = html;
        // Active link highlight
        const currentPage = 'reservation.html';
        document.querySelectorAll('.nav-row a').forEach(a => {
          const page = a.getAttribute('href').split('/').pop();
          if(page === currentPage){ a.classList.add('active'); }
        });

        // Hide logo on scroll
        const siteHeader = h.querySelector('.site-header');
        const updateLogoVisibility = () => {
          if(window.scrollY > 60) siteHeader.classList.add('hide-logo');
          else siteHeader.classList.remove('hide-logo');
        };
        updateLogoVisibility();
        window.addEventListener('scroll', updateLogoVisibility, { passive: true });
      });
  </script>

  <main>
    <section class="welcome-hero">
      <div class="container">
        <h1>Reservation &amp; Anfrage</h1>
        <p class="welcome-subtitle">Nutzen Sie das Formular für Ihre Buchungsanfrage oder Fragen. Wir melden uns schnellstmöglich.</p>
      </div>
    </section>

    <section class="section">
      <div class="container two-column">
        <!-- FORM COLUMN -->
        <div class="col-text">
          <h2>Buchungsanfrage</h2>
          <form id="reservationForm" novalidate>
            <div class="form-row">
              <label for="name">Name *</label>
              <input type="text" id="name" name="name" required />
            </div>
            <div class="form-row">
              <label for="email">E-Mail *</label>
              <input type="email" id="email" name="email" required />
            </div>
            <div class="form-row">
              <label for="phone">Telefon (optional)</label>
              <input type="tel" id="phone" name="phone" />
            </div>
            <div class="form-row form-row-inline">
              <div>
                <label for="arrival">Anreise *</label>
                <input type="date" id="arrival" name="arrival" required />
              </div>
              <div>
                <label for="departure">Abreise *</label>
                <input type="date" id="departure" name="departure" required />
              </div>
            </div>
            <div class="form-row">
              <label for="guests">Anzahl Gäste *</label>
              <input type="number" id="guests" name="guests" min="1" max="6" required />
            </div>
            <div class="form-row">
              <label for="room">Zimmer *</label>
              <select id="room" name="room" required>
                <option value="">Bitte wählen</option>
                <option value="grande_suite">Grande Suite</option>
                <option value="cozy_retreat">Cozy Retreat</option>
                <option value="princess_room">Princess Room</option>
              </select>
            </div>
            <div class="form-row">
              <label for="message">Nachricht / Besonderheiten</label>
              <textarea id="message" name="message" rows="5" placeholder="Fragen, spezielle Wünsche, Uhrzeit für Check-in ..."></textarea>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary btn-large">Anfrage senden</button>
            </div>
            <p class="form-note">Mit * gekennzeichnete Felder sind Pflichtfelder.</p>
            <div id="formStatus" aria-live="polite"></div>
          </form>
        </div>

        <!-- AVAILABILITY COLUMN -->
        <div class="col-media">
          <h2>Verfügbarkeit</h2>
          <p>Die folgenden Kalender zeigen belegte Zeiträume. Eine Nacht ist frei, wenn für diese Nacht kein Eintrag erscheint. Details zur Interpretation finden Sie unter <a href="/bnb_website/informationen.html#wie-verfuegbarkeit">Wie lese ich die Verfügbarkeit?</a>. Bei Fragen einfach kurz melden – wir bestätigen rasch.</p>

          <div class="calendar-embeds">
            <h3>The Grande Suite</h3>
            <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&ctz=Europe%2FZurich&bgcolor=%23ffffff&title=The%20Grande%20Suite&showPrint=0&showTabs=0&showCalendars=0&showTz=0&src=ZHA4cHVxYTZzMDduMzMydGQ4OHVuZWlzdGt0dm51ZHFAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&color=%233F51B5" 
            style="border:solid 1px #777" width="100%" height="300" frameborder="0" scrolling="no"></iframe>
            <h3>The Cozy Retreat</h3>
            <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&ctz=Europe%2FZurich&bgcolor=%23ffffff&title=The%20Cozy%20Retreat&showPrint=0&showTabs=0&showCalendars=0&showTz=0&src=kd8vbd0stlbqp0d7mkvb19s7e8us9ogp%40import.calendar.google.com&color=%23B62D2D"
                style="border:solid 1px #777" width="100%" height="300" frameborder="0" scrolling="no"></iframe>
            <h3>The Princess Room</h3>
            <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&ctz=Europe%2FZurich&bgcolor=%23ffffff&title=The%20Princess%20Room&showPrint=0&showTabs=0&showCalendars=0&showTz=0&src=NHUwYjF1amNsMHU5cjA2b3NxdGNkMTQ2ZzBuczRsMTdAaW1wb3J0LmNhbGVuZGFyLmdvb2dsZS5jb20&color=%23B39DDB"
                style="border:solid 1px #777" width="100%" height="300" frameborder="0" scrolling="no"></iframe>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="footer"></div>
  <script>
    fetch('/bnb_website/footer.html')
      .then(r=>r.text())
      .then(html => {
        const f = document.getElementById('footer');
        f.innerHTML = html;
        const yearSpan = f.querySelector('.js-current-year');
        if(yearSpan) yearSpan.textContent = new Date().getFullYear();
      });
  </script>

  <script>
  // --- Form submission (mailto fallback) ---
  document.getElementById('reservationForm').addEventListener('submit', function(e){
    e.preventDefault();
    const status = document.getElementById('formStatus');
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const arrival = document.getElementById('arrival').value;
    const departure = document.getElementById('departure').value;
    const guests = document.getElementById('guests').value;
    const room = document.getElementById('room').value;
    const message = document.getElementById('message').value.trim();

    // Basic validation
    if(!name || !email || !arrival || !departure || !room || !guests){
      status.textContent = 'Bitte alle Pflichtfelder ausfüllen.';
      status.className = 'form-status form-error';
      return;
    }
    if(departure <= arrival){
      status.textContent = 'Abreisedatum muss nach Anreisedatum liegen.';
      status.className = 'form-status form-error';
      return;
    }

    // Zimmer-Label für die Mail (schönere Bezeichnung als der technische Wert)
    const roomLabels = {
      grande_suite: 'Grande Suite',
      cozy_retreat: 'Cozy Retreat',
      princess_room: 'Princess Room'
    };
    const roomLabel = roomLabels[room] || room;

    // Betreff etwas freundlicher
    const subject = encodeURIComponent(`Anfrage ${roomLabel} - ${arrival} bis ${departure}`);

    // Mail-Text schön formatiert
    let bodyText = `Guten Tag\n\n`;
    bodyText += `Ich interessiere mich für eine Reservation im Bed & Breakfast Tulipan.\n\n`;
    bodyText += `Details zur Anfrage:\n`;
    bodyText += `- Zimmer: ${roomLabel}\n`;
    bodyText += `- Anreise: ${arrival}\n`;
    bodyText += `- Abreise: ${departure}\n`;
    bodyText += `- Anzahl Gäste: ${guests}\n\n`;
    bodyText += `Kontaktdaten:\n`;
    bodyText += `- Name: ${name}\n`;
    bodyText += `- E-Mail: ${email}\n`;
    if (phone) {
      bodyText += `- Telefon: ${phone}\n`;
    }
    bodyText += `\nZusätzliche Nachricht / Besonderheiten:\n`;
    bodyText += message ? `${message}\n\n` : `(keine Angaben)\n\n`;
    bodyText += `Herzliche Grüsse\n`;
    bodyText += `${name}\n`;

    const body = encodeURIComponent(bodyText);

    const mailtoUrl = `mailto:yvonne.birchler@bnb-tulipan.ch?subject=${subject}&body=${body}`;
    window.location.href = mailtoUrl;

    status.textContent = 'E-Mail wird vorbereitet. Falls kein Mail-Client öffnet, bitte manuell senden.';
    status.className = 'form-status form-info';
  });
</script>

</body>
</html>